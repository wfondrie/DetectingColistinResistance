---
title: "Writing Supplementary Tables"
output: github_document
---


```{r loadLibraries, results = "hide"}
# data manipulation
library(tidyverse, quietly = T)
library(stringr, quietly = T)
library(forcats, quietly = T)

# writing to excel files
library(openxlsx, quietly = T)

# other functions
source("../R/utilityFunctions.R")

# for reproducibility
set.seed(937426)
```


### Supplementary Table 1  

```{r}
testList <- readRDS("../temp/testDatList.rds")
abRes <- readRDS("../temp/abRes.rds")
kpRes <- readRDS("../temp/kpRes.rds")

createTbl <- function(summDf, resDf) {
    
    summDf %>%
    cbind(resDf) %>%
    mutate(Class = ifelse(truth == "pos", "Colistin-Resistant", "Other Species"),
           Class = ifelse(truth == "neg", "Colistin-Susceptible", Class),
           type = str_replace(type, " - .+$", ""),
           type = str_replace(type, " [^ ]*[0-9].*$", "")) %>%
    rename(Species = type, 
           `Colistin-Resistant Score` = pos,
           `Colistin-Susceptible Score` = neg,
           `Other Species Score` = other,
           `Species Score` = speciesVsOther,
           `Susceptible or Other Species Score` = posVsAll) %>%
    select(Species,
           Class,
           `Colistin-Resistant Score`,
           `Colistin-Susceptible Score`,
           `Other Species Score`,
           `Species Score`,
           `Susceptible or Other Species Score`,
           starts_with("mz"))
    
}

abTest <- createTbl(testList$Ab, abRes)
kpTest <- createTbl(testList$Kp, kpRes)

testSetRes <- list(`A. baumannii Test Set` = abTest,
                   `K. pneumoniae Test Set` = kpTest)

write.xlsx(testSetRes, "../results/testSetResults.xlsx")

```

### Supplementary Table 2
```{r}
mixedSumm <- readRDS("../temp/complexSpectraSummary.rds")
mixedComponents <- readRDS("../temp/complexComponents.rds")

mixedList <- readRDS("../temp/mixtureDatList.rds")

specWeights <- mixedComponents
```


### Supplementary Table 4

